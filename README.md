# ADAPT and Aquaformer
Powered by phase space reconstruction (PSR), Aquaformer is a Transformer-based model dedicated to the long sequence time-series forecasting (LSTF) of water quality data, compatible with multi-source transfer learning. In ADAPT, Aquaformer is used to represent the water quality dynamics corresponding to certain combination of model parameter values. The parameters of water dynamics and quality models determine how the water quality indicators change with time. ADAPT analyzes real-time monitoring data and dynamically update model parameter values through data assimilation. The water dynamics and quality model in this example is Environmental Fluid Dynamics Code (EFDC). 

## Usage

1. Install Python 3.8. For convenience, execute the following command.

```
pip install -r requirements.txt
```

2. Prepare Data. A series of Aquaformers need to be trained from phase-space-aligned datasets generated by EFDC models with different model parameter value combinations applied. Refer to main_train.py for necessary data and place them in desired paths. 

3. Train the phase-space-aligned model ensemble. Execute main_train.py to produce model files, which could be used later during data assimilation. 

4. Data assimilation. Place the EFDC project folder into ./EE. Execute main.py to realize dynamic parameter updating. The parameters to be adjusted could be determined according to user's needs. The default adjusted parameters are KRO and KTR. Refer to ./utils/efdc.py for customization. Update the paths in run.bat to correctly call the EFDC executable in the user's computer. 

## Contact
If you have any questions or suggestions, feel free to contact:

- Mingzhuang Sun (smz21@mails.tsinghua.edu.cn)

Or describe it in Issues.

## Acknowledgement

This project is supported by the National Natural Science Foundation of China (No. 52070112, 41890823). 
